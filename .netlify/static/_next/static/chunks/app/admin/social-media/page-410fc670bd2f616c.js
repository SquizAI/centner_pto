(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7221],{3998:(e,t,s)=>{"use strict";s.d(t,{$:()=>o,r:()=>l});var a=s(95155),r=s(12115),n=s(32467),i=s(83101),c=s(64269);let l=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),o=r.forwardRef((e,t)=>{let{className:s,variant:r,size:i,asChild:o=!1,...d}=e,m=o?n.DX:"button";return(0,a.jsx)(m,{className:(0,c.cn)(l({variant:r,size:i,className:s})),ref:t,...d})});o.displayName="Button"},11186:(e,t,s)=>{"use strict";s.d(t,{bq:()=>u,eb:()=>f,gC:()=>h,l6:()=>d,yv:()=>m});var a=s(95155),r=s(12115),n=s(55644),i=s(24033),c=s(12108),l=s(5917),o=s(64269);let d=n.bL;n.YJ;let m=n.WT,u=r.forwardRef((e,t)=>{let{className:s,children:r,...c}=e;return(0,a.jsxs)(n.l9,{ref:t,className:(0,o.cn)("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...c,children:[r,(0,a.jsx)(n.In,{asChild:!0,children:(0,a.jsx)(i.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=n.l9.displayName;let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.PP,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(c.A,{className:"h-4 w-4"})})});p.displayName=n.PP.displayName;let x=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.wn,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})});x.displayName=n.wn.displayName;let h=r.forwardRef((e,t)=>{let{className:s,children:r,position:i="popper",...c}=e;return(0,a.jsx)(n.ZL,{children:(0,a.jsxs)(n.UC,{ref:t,className:(0,o.cn)("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:i,...c,children:[(0,a.jsx)(p,{}),(0,a.jsx)(n.LM,{className:(0,o.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(x,{})]})})});h.displayName=n.UC.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.JU,{ref:t,className:(0,o.cn)("px-2 py-1.5 text-sm font-semibold",s),...r})}).displayName=n.JU.displayName;let f=r.forwardRef((e,t)=>{let{className:s,children:r,...i}=e;return(0,a.jsxs)(n.q7,{ref:t,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...i,children:[(0,a.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(n.VF,{children:(0,a.jsx)(l.A,{className:"h-4 w-4"})})}),(0,a.jsx)(n.p4,{children:r})]})});f.displayName=n.q7.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.wv,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=n.wv.displayName},11647:(e,t,s)=>{"use strict";s.d(t,{E:()=>c});var a=s(95155);s(12115);var r=s(83101),n=s(64269);let i=(0,r.F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:s,...r}=e;return(0,a.jsx)("div",{className:(0,n.cn)(i({variant:s}),t),...r})}},18332:(e,t,s)=>{"use strict";s.d(t,{Fc:()=>l,TN:()=>o});var a=s(95155),r=s(12115),n=s(83101),i=s(64269);let c=(0,n.F)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),l=r.forwardRef((e,t)=>{let{className:s,variant:r,...n}=e;return(0,a.jsx)("div",{ref:t,role:"alert",className:(0,i.cn)(c({variant:r}),s),...n})});l.displayName="Alert",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("h5",{ref:t,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",s),...r})}).displayName="AlertTitle";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",s),...r})});o.displayName="AlertDescription"},57348:(e,t,s)=>{Promise.resolve().then(s.bind(s,90640))},64269:(e,t,s)=>{"use strict";s.d(t,{cn:()=>n});var a=s(2821),r=s(75889);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,a.$)(t))}},73457:(e,t,s)=>{"use strict";s.d(t,{S:()=>l});var a=s(95155),r=s(12115),n=s(38162),i=s(5917),c=s(64269);let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.bL,{ref:t,className:(0,c.cn)("peer h-5 w-5 shrink-0 rounded border border-input bg-background ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground data-[state=checked]:border-primary transition-colors",s),...r,children:(0,a.jsx)(n.C1,{className:(0,c.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})})});l.displayName=n.bL.displayName},86948:(e,t,s)=>{"use strict";s.d(t,{BT:()=>o,Wu:()=>d,ZB:()=>l,Zp:()=>i,aR:()=>c,wL:()=>m});var a=s(95155),r=s(12115),n=s(64269);let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow",s),...r})});i.displayName="Card";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...r})});c.displayName="CardHeader";let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("font-semibold leading-none tracking-tight",s),...r})});l.displayName="CardTitle";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});o.displayName="CardDescription";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...r})});d.displayName="CardContent";let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",s),...r})});m.displayName="CardFooter"},90640:(e,t,s)=>{"use strict";s.d(t,{default:()=>B});var a=s(95155),r=s(12115),n=s(20063),i=s(3998),c=s(86948),l=s(18332),o=s(11647),d=s(25667),m=s(64269);let u=d.bL,p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(d.B8,{ref:t,className:(0,m.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",s),...r})});p.displayName=d.B8.displayName;let x=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(d.l9,{ref:t,className:(0,m.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",s),...r})});x.displayName=d.l9.displayName;let h=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(d.UC,{ref:t,className:(0,m.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r})});h.displayName=d.UC.displayName;var f=s(67161),g=s(73155),v=s(5917),j=s(65229),y=s(89559),b=s(71360),N=s(30926);let w=(0,N.createServerReference)("404288038811d19af2d37240af8d1e5ae1e600f3e9",N.callServer,void 0,N.findSourceMapURL,"disconnectAccount"),k=(0,N.createServerReference)("4069a4b7dc70fc8d92ed8c0550d81855163abe246b",N.callServer,void 0,N.findSourceMapURL,"syncAccount");var S=s(11186),_=s(73457),C=s(9484);let I=r.forwardRef((e,t)=>{let{className:s,value:r,...n}=e;return(0,a.jsx)(C.bL,{ref:t,className:(0,m.cn)("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",s),...n,children:(0,a.jsx)(C.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});I.displayName=C.bL.displayName;var A=s(39867),R=s(42196),F=s(61362);let z=(0,N.createServerReference)("40cce6cc0cc78ecac72290df65e1d00a29872c5593",N.callServer,void 0,N.findSourceMapURL,"importPosts");function L(e){let{connections:t,albums:s}=e,[n,d]=(0,r.useState)(""),[m,u]=(0,r.useState)(""),[p,x]=(0,r.useState)([]),[h,f]=(0,r.useState)(new Set),[g,v]=(0,r.useState)(!1),[j,y]=(0,r.useState)(!1),[b,N]=(0,r.useState)(0),[w,k]=(0,r.useState)(null),C=async()=>{if(n){v(!0),k(null),x([]),f(new Set);try{let e=await fetch("/api/social-media/instagram/posts?connectionId=".concat(n,"&limit=50")),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to fetch posts");x(t.posts||[]),k({type:"success",text:"Loaded ".concat(t.posts.length," posts")})}catch(e){console.error("Error fetching posts:",e),k({type:"error",text:e instanceof Error?e.message:"Failed to fetch posts"})}finally{v(!1)}}},L=async()=>{if(!m||0===h.size)return;y(!0),N(0),k(null);let e=p.filter(e=>h.has(e.id)).map(e=>({id:e.id,media_url:e.media_url,caption:e.caption,timestamp:e.timestamp,permalink:e.permalink,metadata:{media_type:e.media_type,like_count:e.like_count,comments_count:e.comments_count}}));try{let t=await z({connectionId:n,albumId:m,posts:e});t.success?(k({type:"success",text:"Successfully imported ".concat(t.imported," photo(s)").concat(t.failed?". ".concat(t.failed," failed."):"")}),x(e=>e.map(e=>h.has(e.id)?{...e,isImported:!0}:e)),f(new Set)):k({type:"error",text:t.error||"Import failed"})}catch(e){console.error("Error importing posts:",e),k({type:"error",text:"An unexpected error occurred"})}finally{y(!1),N(0)}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsx)(c.ZB,{children:"Import from Instagram"}),(0,a.jsx)(c.BT,{children:"Select an account and album, then choose photos to import"})]}),(0,a.jsxs)(c.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Instagram Account"}),(0,a.jsxs)(S.l6,{value:n,onValueChange:d,children:[(0,a.jsx)(S.bq,{children:(0,a.jsx)(S.yv,{placeholder:"Select an account"})}),(0,a.jsx)(S.gC,{children:t.map(e=>(0,a.jsxs)(S.eb,{value:e.id,children:[e.account_name," ",e.account_username&&"(@".concat(e.account_username,")")]},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Target Album"}),(0,a.jsxs)(S.l6,{value:m,onValueChange:u,children:[(0,a.jsx)(S.bq,{children:(0,a.jsx)(S.yv,{placeholder:"Select an album"})}),(0,a.jsx)(S.gC,{children:s.map(e=>(0,a.jsxs)(S.eb,{value:e.id,children:[e.title," (",e.campus,")"]},e.id))})]})]}),(0,a.jsxs)(i.$,{onClick:C,disabled:!n||g,className:"w-full",children:[(0,a.jsx)(A.A,{className:"h-4 w-4 mr-2"}),g?"Loading...":"Fetch Posts"]})]})]}),w&&(0,a.jsx)(l.Fc,{variant:"error"===w.type?"destructive":"default",children:(0,a.jsx)(l.TN,{children:w.text})}),p.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>{f(new Set(p.filter(e=>!e.isImported).map(e=>e.id)))},children:"Select All Available"}),(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>{f(new Set)},children:"Deselect All"}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[h.size," selected"]})]}),(0,a.jsxs)(i.$,{onClick:L,disabled:!m||0===h.size||j,children:[(0,a.jsx)(R.A,{className:"h-4 w-4 mr-2"}),j?"Importing...":"Import ".concat(h.size," Photo(s)")]})]}),j&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I,{value:b}),(0,a.jsx)("p",{className:"text-sm text-center text-muted-foreground",children:"Importing photos..."})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:p.map(e=>(0,a.jsxs)("div",{className:"relative group cursor-pointer border-2 rounded-lg overflow-hidden ".concat(h.has(e.id)?"border-primary":"border-transparent"," ").concat(e.isImported?"opacity-50":""),onClick:()=>{var t;return!e.isImported&&(t=e.id,void f(e=>{let s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s}))},children:[(0,a.jsx)("img",{src:e.thumbnail_url||e.media_url,alt:e.caption||"Instagram post",className:"w-full aspect-square object-cover"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity p-2",children:(0,a.jsx)("p",{className:"text-white text-xs line-clamp-3",children:e.caption||"No caption"})}),!e.isImported&&(0,a.jsx)("div",{className:"absolute top-2 left-2 z-10",children:(0,a.jsx)(_.S,{checked:h.has(e.id)})}),e.isImported&&(0,a.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,a.jsxs)(o.E,{variant:"secondary",className:"flex items-center gap-1",children:[(0,a.jsx)(F.A,{className:"h-3 w-3"}),"Imported"]})}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-white text-xs",children:[void 0!==e.like_count&&(0,a.jsxs)("span",{children:["♥ ",e.like_count]}),void 0!==e.comments_count&&(0,a.jsxs)("span",{children:["\uD83D\uDCAC ",e.comments_count]})]})})]},e.id))})]})]})}var D=s(25276);function E(e){let{connections:t,albums:s}=e,[n,d]=(0,r.useState)(""),[m,u]=(0,r.useState)(""),[p,x]=(0,r.useState)([]),[h,f]=(0,r.useState)(new Set),[g,v]=(0,r.useState)(!1),[j,y]=(0,r.useState)(!1),[b,N]=(0,r.useState)(0),[w,k]=(0,r.useState)(null),C=async()=>{if(n){v(!0),k(null),x([]),f(new Set);try{let e=await fetch("/api/social-media/facebook/posts?connectionId=".concat(n,"&limit=50")),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to fetch photos");x(t.photos||[]),k({type:"success",text:"Loaded ".concat(t.photos.length," photos")})}catch(e){console.error("Error fetching photos:",e),k({type:"error",text:e instanceof Error?e.message:"Failed to fetch photos"})}finally{v(!1)}}},L=async()=>{if(!m||0===h.size)return;y(!0),N(0),k(null);let e=p.filter(e=>h.has(e.id)).map(e=>{var t,s;let a=e.images.reduce((e,t)=>e.width*e.height>t.width*t.height?e:t);return{id:e.id,media_url:a.source,caption:e.name,timestamp:e.created_time,permalink:e.link,metadata:{likes:(null==(s=e.likes)||null==(t=s.summary)?void 0:t.total_count)||0,width:a.width,height:a.height}}});try{let t=await z({connectionId:n,albumId:m,posts:e});t.success?(k({type:"success",text:"Successfully imported ".concat(t.imported," photo(s)").concat(t.failed?". ".concat(t.failed," failed."):"")}),x(e=>e.map(e=>h.has(e.id)?{...e,isImported:!0}:e)),f(new Set)):k({type:"error",text:t.error||"Import failed"})}catch(e){console.error("Error importing photos:",e),k({type:"error",text:"An unexpected error occurred"})}finally{y(!1),N(0)}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsx)(c.ZB,{children:"Import from Facebook"}),(0,a.jsx)(c.BT,{children:"Select a page and album, then choose photos to import"})]}),(0,a.jsxs)(c.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Facebook Page"}),(0,a.jsxs)(S.l6,{value:n,onValueChange:d,children:[(0,a.jsx)(S.bq,{children:(0,a.jsx)(S.yv,{placeholder:"Select a page"})}),(0,a.jsx)(S.gC,{children:t.map(e=>(0,a.jsxs)(S.eb,{value:e.id,children:[e.account_name," ",e.account_username&&"(@".concat(e.account_username,")")]},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Target Album"}),(0,a.jsxs)(S.l6,{value:m,onValueChange:u,children:[(0,a.jsx)(S.bq,{children:(0,a.jsx)(S.yv,{placeholder:"Select an album"})}),(0,a.jsx)(S.gC,{children:s.map(e=>(0,a.jsxs)(S.eb,{value:e.id,children:[e.title," (",e.campus,")"]},e.id))})]})]}),(0,a.jsxs)(i.$,{onClick:C,disabled:!n||g,className:"w-full",children:[(0,a.jsx)(A.A,{className:"h-4 w-4 mr-2"}),g?"Loading...":"Fetch Photos"]})]})]}),w&&(0,a.jsx)(l.Fc,{variant:"error"===w.type?"destructive":"default",children:(0,a.jsx)(l.TN,{children:w.text})}),p.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>{f(new Set(p.filter(e=>!e.isImported).map(e=>e.id)))},children:"Select All Available"}),(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>{f(new Set)},children:"Deselect All"}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[h.size," selected"]})]}),(0,a.jsxs)(i.$,{onClick:L,disabled:!m||0===h.size||j,children:[(0,a.jsx)(R.A,{className:"h-4 w-4 mr-2"}),j?"Importing...":"Import ".concat(h.size," Photo(s)")]})]}),j&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(I,{value:b}),(0,a.jsx)("p",{className:"text-sm text-center text-muted-foreground",children:"Importing photos..."})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:p.map(e=>{var t,s,r;let n=e.picture||(null==(t=e.images[0])?void 0:t.source),i=(null==(r=e.likes)||null==(s=r.summary)?void 0:s.total_count)||0;return(0,a.jsxs)("div",{className:"relative group cursor-pointer border-2 rounded-lg overflow-hidden ".concat(h.has(e.id)?"border-primary":"border-transparent"," ").concat(e.isImported?"opacity-50":""),onClick:()=>{var t;return!e.isImported&&(t=e.id,void f(e=>{let s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s}))},children:[(0,a.jsx)("img",{src:n,alt:e.name||"Facebook photo",className:"w-full aspect-square object-cover"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity p-2",children:(0,a.jsx)("p",{className:"text-white text-xs line-clamp-3",children:e.name||"No caption"})}),!e.isImported&&(0,a.jsx)("div",{className:"absolute top-2 left-2 z-10",children:(0,a.jsx)(_.S,{checked:h.has(e.id)})}),e.isImported&&(0,a.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,a.jsxs)(o.E,{variant:"secondary",className:"flex items-center gap-1",children:[(0,a.jsx)(F.A,{className:"h-3 w-3"}),"Imported"]})}),i>0&&(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2",children:(0,a.jsxs)("div",{className:"flex items-center gap-1 text-white text-xs",children:[(0,a.jsx)(D.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:i})]})})]},e.id)})})]})]})}function B(e){let{initialConnections:t,albums:s}=e,o=(0,n.useSearchParams)(),[d,m]=(0,r.useState)(t),[v,j]=(0,r.useState)("connections"),[y,b]=(0,r.useState)(null),[N,S]=(0,r.useState)({});(0,r.useEffect)(()=>{let e=o.get("success"),t=o.get("error");e?(b({type:"success",text:e}),window.history.replaceState({},"","/admin/social-media")):t&&(b({type:"error",text:t}),window.history.replaceState({},"","/admin/social-media"))},[o]);let _=e=>{window.location.href="/api/social-media/".concat(e,"/auth")},C=async e=>{if(!confirm("Are you sure you want to disconnect this account? Import history will be preserved."))return;S(t=>({...t,[e]:!0}));let t=await w(e);t.success?(m(t=>t.filter(t=>t.id!==e)),b({type:"success",text:"Account disconnected successfully"})):b({type:"error",text:t.error||"Failed to disconnect account"}),S(t=>({...t,[e]:!1}))},I=async e=>{S(t=>({...t,["sync-".concat(e)]:!0}));let t=await k(e);t.success?(b({type:"success",text:"Account synced successfully"}),m(t=>t.map(t=>t.id===e?{...t,last_sync_at:new Date().toISOString()}:t))):b({type:"error",text:t.error||"Failed to sync account"}),S(t=>({...t,["sync-".concat(e)]:!1}))},A=d.filter(e=>"instagram"===e.platform),R=d.filter(e=>"facebook"===e.platform);return(0,a.jsxs)("div",{className:"space-y-6",children:[y&&(0,a.jsx)(l.Fc,{variant:"error"===y.type?"destructive":"default",children:(0,a.jsx)(l.TN,{children:y.text})}),(0,a.jsxs)(u,{value:v,onValueChange:j,children:[(0,a.jsxs)(p,{children:[(0,a.jsx)(x,{value:"connections",children:"Connections"}),(0,a.jsx)(x,{value:"instagram",disabled:0===A.length,children:"Instagram Import"}),(0,a.jsx)(x,{value:"facebook",disabled:0===R.length,children:"Facebook Import"})]}),(0,a.jsxs)(h,{value:"connections",className:"space-y-6",children:[(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(f.A,{className:"h-6 w-6 text-pink-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(c.ZB,{children:"Instagram Business"}),(0,a.jsx)(c.BT,{children:"Connect your Instagram Business account to import photos"})]})]}),0===A.length&&(0,a.jsxs)(i.$,{onClick:()=>_("instagram"),children:[(0,a.jsx)(f.A,{className:"h-4 w-4 mr-2"}),"Connect Instagram"]})]})}),(0,a.jsx)(c.Wu,{children:A.length>0?(0,a.jsx)("div",{className:"space-y-4",children:A.map(e=>(0,a.jsx)(T,{connection:e,onDisconnect:C,onSync:I,loading:N},e.id))}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"No Instagram account connected. Connect your Instagram Business account to start importing photos."})})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(g.A,{className:"h-6 w-6 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(c.ZB,{children:"Facebook Page"}),(0,a.jsx)(c.BT,{children:"Connect your Facebook page to import photos"})]})]}),0===R.length&&(0,a.jsxs)(i.$,{onClick:()=>_("facebook"),children:[(0,a.jsx)(g.A,{className:"h-4 w-4 mr-2"}),"Connect Facebook"]})]})}),(0,a.jsx)(c.Wu,{children:R.length>0?(0,a.jsx)("div",{className:"space-y-4",children:R.map(e=>(0,a.jsx)(T,{connection:e,onDisconnect:C,onSync:I,loading:N},e.id))}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"No Facebook page connected. Connect your Facebook page to start importing photos."})})]})]}),(0,a.jsx)(h,{value:"instagram",children:A.length>0&&(0,a.jsx)(L,{connections:A,albums:s})}),(0,a.jsx)(h,{value:"facebook",children:R.length>0&&(0,a.jsx)(E,{connections:R,albums:s})})]})]})}function T(e){let{connection:t,onDisconnect:s,onSync:r,loading:n}=e,c=t.token_expires_at&&new Date(t.token_expires_at)<=new Date;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:t.is_active&&!c?(0,a.jsx)(v.A,{className:"h-5 w-5 text-green-500"}):(0,a.jsx)(j.A,{className:"h-5 w-5 text-red-500"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"font-medium",children:t.account_name}),t.account_username&&(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["@",t.account_username]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsxs)("span",{children:["Connected ",new Date(t.connected_at).toLocaleDateString()]}),t.last_sync_at&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:"•"}),(0,a.jsxs)("span",{children:["Last synced ",new Date(t.last_sync_at).toLocaleString()]})]})]}),t.last_error&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:t.last_error}),c&&(0,a.jsx)(o.E,{variant:"destructive",className:"mt-1",children:"Token Expired"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>r(t.id),disabled:!!n["sync-".concat(t.id)]||!!c,children:[(0,a.jsx)(y.A,{className:"h-4 w-4 mr-2 ".concat(n["sync-".concat(t.id)]?"animate-spin":"")}),"Sync"]}),(0,a.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>s(t.id),disabled:!!n[t.id],children:[(0,a.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Disconnect"]})]})]})}}},e=>{e.O(0,[4909,3529,2659,9065,6949,8441,1255,7358],()=>e(e.s=57348)),_N_E=e.O()}]);